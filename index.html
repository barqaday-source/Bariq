<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EBQAD | لوحة التحكم الشاملة</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background: #0B1020; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .card { background: rgba(255,255,255,0.03); border: 1px solid rgba(78,243,232,0.1); transition: 0.3s; }
        .card:hover { border-color: #4EF3E8; }
        /* تحسين اللمس للهواتف */
        input, textarea, button { font-size: 16px !important; } 
    </style>
</head>
<body class="flex flex-col md:flex-row min-h-screen">

    <nav class="md:hidden fixed bottom-0 left-0 right-0 bg-black/90 backdrop-blur-lg border-t border-white/10 z-50 flex justify-around p-3">
        <button onclick="showTab('projects')" class="text-cyan-400 text-xl"><i class="fas fa-project-diagram"></i></button>
        <button onclick="showTab('messages')" class="text-white/50 text-xl"><i class="fas fa-envelope"></i></button>
        <button onclick="showTab('about')" class="text-white/50 text-xl"><i class="fas fa-user-edit"></i></button>
    </nav>

    <aside class="hidden md:flex w-64 bg-black/40 p-6 border-l border-white/5 flex-col gap-6">
        <h1 class="text-2xl font-bold text-cyan-400 text-center tracking-widest">EBQAD</h1>
        <div class="flex flex-col gap-2">
            <button onclick="showTab('projects')" class="text-right p-3 rounded-xl hover:bg-cyan-400/10 transition">المشاريع</button>
            <button onclick="showTab('messages')" class="text-right p-3 rounded-xl hover:bg-cyan-400/10 transition">الرسائل</button>
            <button onclick="showTab('about')" class="text-right p-3 rounded-xl hover:bg-cyan-400/10 transition">معلوماتي</button>
        </div>
    </aside>

    <main class="flex-1 p-4 md:p-10 mb-20 md:mb-0">
        
        <section id="projects" class="tab-content active">
            <h2 class="text-2xl font-bold text-cyan-400 mb-6 flex items-center gap-2">
                <i class="fas fa-plus-circle text-sm"></i> إضافة مشروع جديد
            </h2>
            <div class="card p-4 md:p-6 rounded-2xl mb-8 flex flex-col gap-4">
                <input id="t" type="text" placeholder="عنوان المشروع" class="bg-white/5 p-3 rounded-xl border border-white/10 outline-none focus:border-cyan-400">
                <input id="i" type="text" placeholder="رابط صورة المشروع" class="bg-white/5 p-3 rounded-xl border border-white/10 outline-none focus:border-cyan-400">
                <textarea id="d" placeholder="وصف المشروع بالتفصيل..." class="bg-white/5 p-3 rounded-xl border border-white/10 h-24 outline-none focus:border-cyan-400"></textarea>
                <button onclick="addProject()" class="bg-cyan-400 text-black font-bold py-4 rounded-xl shadow-[0_0_20px_rgba(78,243,232,0.2)] active:scale-95 transition">حفظ في قاعدة البيانات</button>
            </div>
            
            <h3 class="text-xl font-bold mb-4">المشاريع الحالية</h3>
            <div id="p-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                </div>
        </section>

        <section id="messages" class="tab-content">
            <h2 class="text-2xl font-bold text-cyan-400 mb-6">صندوق الوارد</h2>
            <div id="m-list" class="flex flex-col gap-4"></div>
        </section>

        <section id="about" class="tab-content">
            <h2 class="text-2xl font-bold text-cyan-400 mb-6">تعديل بيانات البروفايل</h2>
            <div class="card p-6 rounded-2xl">
                <textarea id="aboutArea" class="w-full bg-black/30 p-4 rounded-xl border border-white/10 h-48 mb-4 outline-none focus:border-cyan-400 text-cyan-100"></textarea>
                <button onclick="saveAbout()" class="w-full bg-cyan-400 text-black font-bold py-3 rounded-xl">تحديث الموقع فوراً</button>
            </div>
        </section>

    </main>

    <script>
        const API = "http://127.0.0.1:5000/api";

        function showTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            // تحديث ألوان الأيقونات في الجوال
            document.querySelectorAll('nav button').forEach(btn => btn.classList.replace('text-cyan-400', 'text-white/50'));
            event.currentTarget.classList.replace('text-white/50', 'text-cyan-400');
        }

        async function loadData() {
            try {
                const pr = await (await fetch(`${API}/projects`)).json();
                document.getElementById('p-list').innerHTML = pr.map(p => `
                    <div class="card p-4 rounded-2xl">
                        <img src="${p.image_url}" class="w-full h-32 object-cover rounded-xl mb-3 bg-white/5" onerror="this.src='https://via.placeholder.com/300x150?text=No+Image'">
                        <h4 class="font-bold text-cyan-400 truncate">${p.title}</h4>
                        <p class="text-xs text-slate-400 mb-4 line-clamp-2">${p.description}</p>
                        <button onclick="delP(${p.id})" class="w-full py-2 bg-red-500/10 text-red-400 rounded-lg border border-red-500/20 hover:bg-red-500 hover:text-white transition">حذف نهائي</button>
                    </div>
                `).join('');

                const ms = await (await fetch(`${API}/messages`)).json();
                document.getElementById('m-list').innerHTML = ms.length ? ms.map(m => `
                    <div class="card p-5 rounded-2xl flex flex-col gap-2">
                        <div class="flex justify-between items-start">
                            <span class="font-bold text-cyan-400">${m.name}</span>
                            <a href="mailto:${m.email}" class="text-xs bg-cyan-400/10 text-cyan-400 px-3 py-1 rounded-full border border-cyan-400/20">رد سريع</a>
                        </div>
                        <p class="text-sm text-slate-300 bg-black/20 p-3 rounded-lg">${m.message}</p>
                        <span class="text-[10px] text-slate-600">${m.date}</span>
                    </div>
                `).join('') : '<p class="text-center text-slate-600">لا توجد رسائل جديدة</p>';

                const ab = await (await fetch(`${API}/about`)).json();
                document.getElementById('aboutArea').value = ab.content;
            } catch (e) { console.log("السيرفر غير متصل"); }
        }

        async function addProject() {
            const data = { title:document.getElementById('t').value, description:document.getElementById('d').value, image_url:document.getElementById('i').value, tech_stack: "FullStack" };
            const res = await fetch(`${API}/projects`, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(data) });
            if(res.ok) { alert("تم الحفظ!"); loadData(); }
        }

        async function delP(id) { if(confirm('متأكد؟')) { await fetch(`${API}/projects/${id}`, {method:'DELETE'}); loadData(); } }
        async function saveAbout() { await fetch(`${API}/about`, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({content: document.getElementById('aboutArea').value}) }); alert("تحدث البروفايل!"); }

        window.onload = loadData;
    </script>
</body>
                </html>
                
